<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36" version="24.7.6">
  <diagram name="Page-1" id="c4acf3e9-155e-7222-9cf6-157b1a14988f">
    <mxGraphModel dx="1465" dy="775" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-21" value="Classname" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="110" y="190" width="160" height="136" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-22" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="rUS7NZgCJsVe6Tk2w-7R-21" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-23" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="rUS7NZgCJsVe6Tk2w-7R-21" vertex="1">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-24" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="rUS7NZgCJsVe6Tk2w-7R-21" vertex="1">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-25" value="Object" style="html=1;whiteSpace=wrap;" parent="rUS7NZgCJsVe6Tk2w-7R-21" vertex="1">
          <mxGeometry y="86" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-26" value="处理流程" style="html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="700" y="140" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-27" value="user1" style="html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="390" y="210" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-28" value="user1" style="html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="390" y="210" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="rUS7NZgCJsVe6Tk2w-7R-29" target="rUS7NZgCJsVe6Tk2w-7R-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-29" value="user2" style="html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="390" y="285" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-30" value="user3" style="html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="390" y="360" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-31" value="服务器server&lt;div&gt;Mysql Client&lt;/div&gt;" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="270" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.03;entryY=0.373;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="rUS7NZgCJsVe6Tk2w-7R-28" target="rUS7NZgCJsVe6Tk2w-7R-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.033;entryY=0.683;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="rUS7NZgCJsVe6Tk2w-7R-30" target="rUS7NZgCJsVe6Tk2w-7R-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-35" value="request" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="560" y="210" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-36" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="810" y="309.66" as="sourcePoint" />
            <mxPoint x="880" y="309.66" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-37" value="mysql Server" style="whiteSpace=wrap;html=1;aspect=fixed;" parent="1" vertex="1">
          <mxGeometry x="900" y="270" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-42" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" source="rUS7NZgCJsVe6Tk2w-7R-51" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="360" as="sourcePoint" />
            <mxPoint x="790" y="440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-43" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="860" y="440" as="sourcePoint" />
            <mxPoint x="810" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-44" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="690" y="450" width="360" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-38" value="Connection" style="rounded=0;whiteSpace=wrap;html=1;" parent="rUS7NZgCJsVe6Tk2w-7R-44" vertex="1">
          <mxGeometry width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-39" value="Connection" style="rounded=0;whiteSpace=wrap;html=1;" parent="rUS7NZgCJsVe6Tk2w-7R-44" vertex="1">
          <mxGeometry x="90" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-40" value="Connection" style="rounded=0;whiteSpace=wrap;html=1;" parent="rUS7NZgCJsVe6Tk2w-7R-44" vertex="1">
          <mxGeometry x="180" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-41" value="Connection" style="rounded=0;whiteSpace=wrap;html=1;" parent="rUS7NZgCJsVe6Tk2w-7R-44" vertex="1">
          <mxGeometry x="270" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-45" value="多线程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="750" y="243" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-46" value="要保证队列的线程安全" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="550" y="450" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-47" value="epoll + 多线程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="570" y="318" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-48" value="用互斥锁来保证线程安全 mutex&amp;nbsp; lock_guard unique_lock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="610" y="498" width="320" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-49" value="连接池只需要一个实例 所以设计成单例，并且是一个线程安全的单例&lt;div&gt;因为会有多个线程获取这个单例， 所以要设计成线程安全的懒汉式单例模式&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="675" y="523" width="420" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-50" value="连接池空了，100ms内一直看有没有剩余的连接，没有连接，就要创建连接" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="460" y="700" width="420" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-52" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" target="rUS7NZgCJsVe6Tk2w-7R-51" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="360" as="sourcePoint" />
            <mxPoint x="790" y="440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-51" value="&lt;font color=&quot;#ff3333&quot;&gt;服务器要getConnection()，是一个消费者线程&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="610" y="408" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-53" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#6c8ebf;gradientColor=default;" parent="1" vertex="1">
          <mxGeometry x="530" y="438" width="600" height="132" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-55" value="&lt;font color=&quot;#ff3333&quot;&gt;生产者线程负责生产连接 ，上限为maxSize&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="530" y="570" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-56" value="未被使用的连接超过60s，就会被释放" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1140" y="450" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-57" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" source="rUS7NZgCJsVe6Tk2w-7R-51" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="610" as="sourcePoint" />
            <mxPoint x="420" y="620" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="423" />
              <mxPoint x="420" y="600" />
              <mxPoint x="420" y="610" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-58" value="获取的连接用智能指针来管理，用lambda表达式来定制连接 被释放的功能（不是真正的释放，是把连接归还给连接池）" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="85" y="618" width="650" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-59" value="连接的生产和连接的消费采用生产者消费者模型来设计，用了线程间的同步机制 条件变量和互斥锁" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="800" y="648" width="540" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-60" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="940" y="580" as="sourcePoint" />
            <mxPoint x="940" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-61" value="&lt;font color=&quot;#ff6666&quot;&gt;定时线程，清理连接队列中多余的空闲连接&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="980" y="578" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-62" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1230" y="570" as="sourcePoint" />
            <mxPoint x="1270" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rUS7NZgCJsVe6Tk2w-7R-66" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.714;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="rUS7NZgCJsVe6Tk2w-7R-50" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="610" as="sourcePoint" />
            <mxPoint x="760" y="678" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
